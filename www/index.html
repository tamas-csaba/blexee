<!DOCTYPE html>
<!--

-->
<html>
    <head>
        <!--
        Customize this policy to fit your own app's needs. For more guidance, see:
            https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
        Some notes:
            * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
            * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
            * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
                * Enable inline JS: add 'unsafe-inline' to default-src
        -->
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        <link rel="stylesheet" type="text/css" href="css/mdl/material.min.css">
        <link rel="stylesheet" type="text/css" href="css/toastr.min.css"/>
        <link rel="stylesheet" type="text/css" href="css/blexee.css">
        <link rel="stylesheet" type="text/css" href="css/pageslider.css">
        <link rel="stylesheet" href="css/material_icons.css" type="text/css">
        <link rel="stylesheet" href="css/fonts.css" type="text/css">
        <script src="css/mdl/material.js"></script>
        <title>blexee control</title>
    </head>
    <body>
        <!-- Always shows a header, even in smaller screens. -->
        <div id="root"></div>
        
        <script id="app-container-tpl" type="text/template">
            <!-- Always shows a header, even in smaller screens. -->
            <div id="main_page" class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            <header class="mdl-layout__header">
                <div class="mdl-layout__header-row">
                    <!-- Title -->
                    <span class="mdl-layout-title">blexee controller</span>
                    <!-- Add spacer, to align navigation to the right -->
                    <div class="mdl-layout-spacer"></div>
                </div>
            </header>
            <div class="mdl-layout__drawer">
                <span class="mdl-layout-title">blexee</span>
                <nav class="mdl-navigation">
                    {{#each systemMenu}}
                    <a class="mdl-navigation__link btn" href="#jump/{{id}}" onClick="app.toggle_drawer()">        
                        <i class="material-icons">{{menu_icon}}</i> {{caption}}
                    </a>
                    {{/each}}
                </nav>
            </div>
            <main class="mdl-layout__content">
                <div id="{{viewId}}" class="page-content">
                    <!-- Your content goes here -->
                    <div style="color:red; text-align: center;">Undefined Content</div>
                </div>
            </main>
            </div>
        </script>

        <script id="home-menu-tpl" type="text/template">
            {{#if this}}
                {{#each_when_not this "on_start_page" false}}
                    <div class="device-card-square mdl-card mdl-shadow--2dp right">
                        <a class="mdl-card__title mdl-card--expand mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored btn" href="#jump/{{id}}">
                            <h2 class="mdl-card__title-text">{{this.caption}}</h2>
                        </a>
                        <div class="mdl-card__supporting-text">
                            {{this.description}}
                        </div>                    
                    </div>
                {{/each_when_not}}
            {{/if}} 
        </script>
        
        <script id="device-selection-tpl" type="text/template">
            {{#unless this}}{{search}}{{/unless}}
            {{#if this}}
            {{#unless connected}}
            {{#if searching}}
            {{#unless devices}}{{search}}{{/unless}}
            {{else}}
            {{#each devices}}
                {{device_list}}
            {{else}}
            <span class="right" style="color:red">No device was found, please rescan.</span>
            <span class="ctrlbutton">
                <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored btn" href="#reload/{{currentUseCase}}">
                    <i class="material-icons">settings_remote</i>
                </a>
                <br>
                <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect btn" href="#">
                    <i class="material-icons">home</i>
                </a>
            </span>
            {{/each}}
            {{/if}}
            {{/unless}}
            {{#if connected}}
            <span class="right" style="color:red">Program error: device is already connected and not routed correctly.</span>
            <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect btn ctrlbutton" href="#">
                <i class="material-icons">home</i>
            </a>
            {{/if}}
            {{/if}}
        </script>

        <script id="connect-tpl" type="text/template">
        {{#if selectedDevice}}
            <div class="title">{{selectedDevice.name}}</div>
            <p>Please approach the device.</p>
            <!-- lilla: #BA65C9 green: #ACEC00 nice blue: #69aff4-->
            <!-- http://www.smashingmagazine.com/2015/07/designing-simple-pie-charts-with-css/ -->

            <style>
                .pie_circle {
                    fill: none;
                    stroke: #4CAF50;
                    stroke-width: 20;
                    stroke-dasharray: {{absolut_from_percentage selectedDevice.proximity 384}} 376; /* stroke-dasharray: 10 {max}; 2π × circle_radius ≈ max */
                }
                .pie_back{fill: none;
                          stroke: #9E9E9E;
                          opacity: 0.15;
                          stroke-width: 20;
                }
            </style>
            <svg viewBox="0 0 200 200" >
            <text x="100" y="105" font-family="Roboto" font-size="32" fill="#888" text-anchor="middle" dy="5">{{sanitize_number selectedDevice.proximity}}<tspan font-size="12" dy="-12">%</tspan></text>
            <circle class="pie_back" r="60" cx="100" cy="100"></circle>
            <circle class="pie_circle" r="60" cx="100" cy="100"></circle>
            </svg>
        {{else}}
            {{search}}
        {{/if}}
        </script>

        <script id="device-modal-tpl" type="text/template">
            <div id="device_modal_window" class="mdl-layout__container">
            {{#if tabs}}
            <div id="modal_page" class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-tabs">
            {{else}}
            <div id="modal_page" class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
            {{/if}}
                <header class="mdl-layout__header">
                    <div class="mdl-layout__drawer-button">
                        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn" href="#disconnect">
                            <i class="material-icons">navigate_before</i>
                        </a>
                    </div>
                    <div class="mdl-layout__header-row">
                        <!-- Title -->
                        <span class="mdl-layout-title">{{#if connected}}Connected{{else}}Connecting...{{/if}}</span>
                        <!-- Add spacer, to align navigation to the right -->
                        <div class="mdl-layout-spacer"></div>
                        {{#if this}}
                        <a id='service-notification-badge' href="#events" class="mdl-badge material-icons btn" data-badge="{{notificationQueueSize}}">mail_outline</a>
                        {{/if}}
                    </div>
                    {{#if tabs}}
                    <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
                        {{#each tabs}}
                            <a href="#{{link}}" class="mdl-layout__tab {{active}}">{{caption}}</a>
                        {{/each}}
                    </div>
                    {{/if}}
                </header>
                <main class="mdl-layout__content">
                    <div id="{{viewId}}" class="page-content">
                        <!-- Your content goes here -->
                    </div>
                </main>
            </div>
        </div>
        </script>
        
        <script id="ble-services-tpl" type="text/template">
        {{#unless this}}
            {{search}}
        {{/unless}}
        {{#if this}}
            {{#if requestingServices}}
                {{search}}
            {{else}}
                {{#each services}}
                    <div class="service-card-wide mdl-card mdl-shadow--2dp">
                        <div class="mdl-card__title">
                            <h2 class="mdl-card__title-text caption">Service {{uuid}}</h2>
                        </div>
                        <div class="mdl-card__supporting-text">
                            {{#if characteristics}}
                            <table class="mdl-data-table mdl-shadow--2dp box">
                                <thead>
                                <th class="mdl-data-table__cell--non-numeric" style="text-align:left; vertical-align:middle">
                                    <i class="material-icons" style="vertical-align:middle">memory</i>
                                    <span style="vertical-align: middle;display: inline-block;">Characteristics</span>
                                </th>
                                <th>
                                    Action
                                </th>
                                </thead>
                                {{#each characteristics}}
                                <tr>
                                    <td id="td-{{../uuid}}-{{uuid}}" class="mdl-data-table__cell--non-numeric">
                                        <p class="small">{{uuid}}</p>
                                        <p class="small">{{flags}}</p>
                                        <p class="small" id="dsc-{{../uuid}}-{{uuid}}">{{descriptor}}</p>
                                    </td>
                                    <td align="right">
                                        <button id="btn-{{uuid}}"
                                                class="mdl-button mdl-js-button mdl-button--icon ble-characteristic-button btn"
                                                data-characteristic='{"id":"{{../uuid}}-{{uuid}}","serviceUuid":"{{../uuid}}","charUuid":"{{uuid}}","flags":"{{flags}}","descriptor":"{{descriptor}}"}'
                                                >
                                            <i class="material-icons">crop_free</i>
                                        </button>
                                    </td>
                                </tr>
                                {{/each}}
                            </table>
                            {{/if}}
                        </div>
                    </div>
                {{else}}
                <span class="right" style="color:red">Program Error: no services are found.</span>
                <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect btn ctrlbutton" href="#">
                    <i class="material-icons">home</i>
                </a>
                {{/each}}
        {{/if}}
        {{/if}}                                                                                                                            
        </script>

        <script id="settings-tpl" type="text/template">
            {{#unless this}}
            <span class="right" style="color:red">Program Error: no configuration data is found.</span>
            {{/unless}}
            {{#if this}}
            {{#each_when this "display" true}}
            <div class="service-card-wide mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title">
            <h2 class="mdl-card__title-text caption">{{caption}}</h2>
            </div>
            <div class="mdl-card__supporting-text" style="margin: 0 auto;">
            {{#if keys}}
            <!-- <table class="mdl-data-table mdl-data-table--selectable mdl-shadow--2dp box"> -->
            <table class="box">
            <thead>
            <tr class="spacy">
            <th class="mdl-data-table__cell--non-numeric" style="text-align:left; vertical-align:middle">
            <i class="material-icons" style="vertical-align:middle">memory</i>
            {{caption}}
            </th>
            <th></th>
            </tr>
            </thead>
            <tbody>
            {{#each keys}}
            <tr class="spacy">
            <td class="mdl-data-table__cell--non-numeric">{{caption}}</td>
            <td class="right">{{generate_field id type value valueset ../path}}</td>
            </tr>
            {{/each}}
            </tbody>
            </table>
            {{/if}}
            </div>
            </div>
            {{/each_when}}
            {{/if}}
        </script>

        <script id="customer-tpl" type="text/template">
            <div class="mdl-layout__container">
            <div id="device_page" class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
                <header class="mdl-layout__header">
                    <div class="mdl-layout__drawer-button">
                        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn" href="#disconnect">
                            <i class="material-icons">navigate_before</i>
                        </a>
                    </div>
                    <div class="mdl-layout__header-row">
                        <!-- Title -->
                        <span class="mdl-layout-title">Pickup</span>
                        <!-- Add spacer, to align navigation to the right -->
                        <div class="mdl-layout-spacer"></div>
                        {{#if this}}
                        <a id='service-notification-badge' href="#events" class="mdl-badge material-icons btn" data-badge="{{notificationQueueSize}}">mail_outline</a>
                        {{/if}}
                    </div>
                </header>
                <main class="mdl-layout__content">
                    <div id="{{viewId}}" class="page-content">
                        <!-- Your content goes here -->
                        {{#unless this}}
                        {{search}}
                        {{/unless}}
                        {{#if this}}
                        {{#if requestingServices}}
                        {{search}}
                        {{else}}
                        {{#if services}}
                        <div class="service-card-wide mdl-card mdl-shadow--2dp">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text caption">Actions</h2>
                            </div>
                            <div class="mdl-card__supporting-text">
                                <a id="pickup-btn" href="#pickup" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent btn right">
                                    Pickup
                                </a>
                            </div>
                        </div>
                        {{else}}
                        <span class="right" style="color:red">Program Error: no services are found.</span>
                        <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect btn ctrlbutton" href="#disconnect">
                            <i class="material-icons">home</i>
                        </a>
                        {{/if}}
                        {{/if}}
                        {{/if}}
                    </div>
                </main>
            </div>
        </div>
        </script>

        <script id="logistician-tpl" type="text/template">
        {{#xif "this.services && this.tabs"}}
            <section class="mdl-layout__tab-panel is-active" id="delivery">
                <div id="delivery_content">
                    <!-- TAB content goes here -->
                    <div class="service-card-wide mdl-card mdl-shadow--2dp">
                        <div class="mdl-card__title">
                            <h2 class="mdl-card__title-text caption">Actions</h2>
                        </div>
                    <div class="mdl-card__supporting-text">
                        <a id="deliver-btn" href="#deliver" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent right btn">
                            Deliver
                        </a>
                    </div>
                </div>
            </section>
            <section class="mdl-layout__tab-panel" id="service_menu">
                <div id="service_menu_content">
                    <!-- Service Menu TAB content goes here -->
                    {{#if apps}}
                        <div class="mdl-grid">
                            {{#each apps}}
                                <div class="mdl-cell mdl-cell--2-col app_grid">
                                    <a class="app" href="#app/{{id}}">
                                        <i class="material-icons">{{menu_icon}}</i><br>
                                        {{caption}}
                                    </a>
                                </div>
                            {{/each}}
                        </div>
                    {{else}}
                        <span class="right" style="color:red">No APPS are available.</span>
                    {{/if}}
                </div>
            </section> 
        {{else}}
            <div id="{{viewId}}" class="page-content">
                <!-- content here: no tabs need to be loaded -->
                {{#unless this}}
                    {{search}}
                {{/unless}}
                {{#if requestingServices}}
                    {{search}}
                {{else}}
                    <span class="right" style="color:red">Program Error: no services are found.</span>
                    <!-- <a class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect btn ctrlbutton" href="#disconnect">
                        <i class="material-icons">home</i>
                    </a> -->
                {{/if}}
        {{/xif}}
        </script>

        <script id="dashboard-tpl" type="text/template">
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--4-col app_grid mdl-shadow--2dp">
                    <style>
                        .line_fg {
                            fill: none;
                            stroke: #4CAF50;
                            stroke-width: 5;
                        }
                        .line_bg {fill: none;
                            stroke: #9E9E9E;
                            opacity: 0.15;
                            stroke-width: 5;
                        }

                        .pie_circle {
                            fill: none;
                            stroke: #4CAF50;
                            stroke-width: 5;
                            stroke-dasharray: {{absolut_from_percentage cpu 251}} 251; /* stroke-dasharray: 10 {max}; 2π × circle_radius ≈ max */
                        }
                        .pie_back{fill: none;
                            stroke: #9E9E9E;
                            opacity: 0.15;
                            stroke-width: 10;
                        }
                    </style>
                    <svg viewBox="0 0 200 100" >
                        <text x="100" y="50" font-family="Roboto" font-size="12" fill="#888" text-anchor="middle" dy="5">CPU {{cpu}}<tspan font-size="10" dy="-8">%</tspan></text>
                        <circle class="pie_back" r="40" cx="100" cy="50"></circle>
                        <circle class="pie_circle" r="40" cx="100" cy="50"></circle>
                    </svg>
                </div>
                <div class="mdl-cell mdl-cell--4-col app_grid mdl-shadow--2dp">
                    <svg viewBox="0 0 200 40" >
                        <text x="5" y="30" 
                            font-family="Roboto"
                            font-size="11" fill="#888" 
                            text-anchor="start" dy="5">Memory {{memory}}<tspan font-size="10" dx="2" dy="-3">%</tspan></text>
                        <line class="line_bg" x1="5" y1="12" x2="195" y2="12" />
                        <line class="line_fg" x1="5" y1="12" x2="{{absolut_from_percentage memory 195}}" y2="12" />
                    </svg>
                </div>
                <div class="mdl-cell mdl-cell--4-col app_grid mdl-shadow--2dp">
                    <svg viewBox="0 0 200 40" >
                        <text x="5" y="30" 
                            font-family="Roboto"
                            font-size="11" fill="#888" 
                            text-anchor="start" dy="5">Storage {{storage}}<tspan font-size="10" dx="2" dy="-3">%</tspan></text>
                        <line class="line_bg" x1="5" y1="12" x2="195" y2="12" />
                        <line class="line_fg" x1="5" y1="12" x2="{{absolut_from_percentage storage 195}}" y2="12" />
                   </svg>
                </div>
            </div>
            <button id="smenu_back_btn" onclick="app.reloadSavedApplist()" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect ctrlbutton">
                <i class="material-icons">undo</i>
            </button>
        </script>                                                                                                                    

        <script id="not-implemented-tpl" type="text/template">
            <div class="title">Empty</div>
            <span class="right" style="color:red">Not implemented yet</span>
            <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--raised btn ctrlbutton" href="#">
            <i class="material-icons">cached</i>
            Return
            </a>
        </script>

        <script id="err-tpl" type="text/template">
            {{#unless this}}
                <div class="title">General Error</div>
                <span class="right" style="color:red">Unhanled Error Caught</span>
                {{/unless}}
                <div class="title">{{title}}</div>
                <span class="right" style="color:red">{{message}}</span>
                <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--raised btn ctrlbutton" href="#">
                    <i class="material-icons">cached</i>
                    Return
                </a>
        </script>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/libs/fastclick.js"></script>
        <script type="text/javascript" src="js/libs/handlebars.js/handlebars.min.js"></script>
        <script type="text/javascript" src="js/libs/jquery/jquery.js"></script>
        <script type="text/javascript" src="js/libs/PageSlider.js"></script>
        <script type="text/javascript" src="js/libs/Router.js"></script>
        <script type="text/javascript" src="js/libs/toastr.min.js"></script>
        <script type="text/javascript" src="js/core/Domains.js"></script>
        <script type="text/javascript" src="js/views/ViewRepo.js"></script>
        <script type="text/javascript" src="js/services/MenuService.js"></script>
        <script type="text/javascript" src="js/services/DeviceService.js"></script>
        <script type="text/javascript" src="js/services/DataModelService.js"></script>
        <script type="text/javascript" src="js/views/Helpers.js"></script>
        <script type="text/javascript" src="js/libs/handlebars-helper-x.js"></script>
        <script type="text/javascript" src="js/views/GenericView.js"></script>
        <script type="text/javascript" src="js/services/SimuService.js"></script>
        <script type="text/javascript" src="js/services/ConfigurationService.js"></script>
        <script type="text/javascript" src="js/services/HandheldService.js"></script>
        <script type="text/javascript" src="js/services/DispatcherService.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
    </body>
</html>
